{% extends "base.html" %}

{% block content %}
<h1>Все курсы</h1>

{% for course in courses %}
  <div class="card mb-3">
    <div class="card-body">
      <h5 class="card-title">
        {{ course.title }}
        {% if course.is_free %}
          <span class="badge bg-success">Бесплатно</span>
        {% else %}
          <span class="badge bg-danger">Платный</span>
        {% endif %}
      </h5>
      <p class="card-text">{{ course.description|truncatewords:30 }}</p>
      <p><small>Уровень: {{ course.get_level_display }}</small></p>

      {% if course.is_free %}
        <a href="{% url 'course_detail' course.id %}" class="btn btn-primary">Открыть</a>
      {% else %}
        {% if course.id in enrolled_course_ids %}
          <a href="{% url 'course_detail' course.id %}" class="btn btn-primary">Открыть</a>
        {% elif user.is_authenticated %}
          <a href="{% url 'enroll_in_course' course.id %}" class="btn btn-success">Записаться (заглушка)</a>
        {% else %}
          <a href="{% url 'login' %}" class="btn btn-secondary">Войдите, чтобы записаться</a>
        {% endif %}
      {% endif %}
    </div>
  </div>
{% endfor %}
{% endblock %}